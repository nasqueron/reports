#!/usr/bin/env python3

#   -------------------------------------------------------------
#   Run report
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#   Project:        Nasqueron
#   Description:    Run a specific report and format data accordingly
#   License:        BSD-2-Clause
#   -------------------------------------------------------------


import sys

from nasqueron_reports.actions.reports import generate_report
from nasqueron_reports.config import parse_report_config
from nasqueron_reports.errors import *


#   -------------------------------------------------------------
#   Application entry point
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


def run(report_name):
    try:
        report_config = parse_report_config(report_name)
        report = generate_report(report_config)
    except NasqueronReportConfigError as e:
        print(e, file=sys.stderr)
        sys.exit(2)
    except NasqueronReportQueryError as e:
        print(e, file=sys.stderr)
        sys.exit(4)
    except NasqueronReportDatabaseError as e:
        print(f"An error occurred at database level: {e}", file=sys.stderr)
        sys.exit(8)

    print(report.formatted)


if __name__ == "__main__":
    argc = len(sys.argv)

    if argc < 2:
        print(f"Usage: {sys.argv[0]} <report name>", file=sys.stderr)
        sys.exit(1)

    run(sys.argv[1])
